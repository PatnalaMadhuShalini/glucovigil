
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlucoSmart Database Schema</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .schema-container {
            margin: 30px 0;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .table-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .mermaid {
            background-color: white;
            padding: 20px;
            border-radius: 4px;
        }
        .download-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px 0;
            display: block;
        }
        .download-btn:hover {
            background-color: #45a049;
        }
        .table-description {
            background-color: #f1f8ff;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin-bottom: 20px;
            border-radius: 0 4px 4px 0;
        }
    </style>
</head>
<body>
    <h1>GlucoSmart Database Schema</h1>
    <p>Below is a detailed visualization of the database schema for the GlucoSmart application.</p>
    
    <div class="schema-container">
        <h2>Complete Database Schema</h2>
        <p class="table-description">
            This diagram shows the relationship between all tables in the database. 
            The system uses PostgreSQL with a hybrid schema approach, combining relational tables and JSON document storage for flexibility.
        </p>
        <div class="mermaid">
erDiagram
    USERS {
        int id PK
        string username UK
        string password
        string full_name
        string email UK
        string phone
        string gender
        string place
        json achievements
        string preferred_language
        json health_goals
        string verification_token
        boolean verified
    }
    
    HEALTH_DATA {
        int id PK
        int user_id FK
        json demographics
        json physiological
        json lifestyle
        json prediction
        timestamp created_at
        json nutrition_plan
        json exercise_plan
        json achievements
        json medical_records
    }
    
    FEEDBACK {
        int id PK
        int user_id FK
        int rating
        string category
        text comment
        timestamp created_at
    }
    
    USERS ||--o{ HEALTH_DATA : has
    USERS ||--o{ FEEDBACK : provides
        </div>
        <button id="schema-btn" class="download-btn">Download Complete Schema as PNG</button>
    </div>
    
    <div class="table-container">
        <h2>Users Table</h2>
        <p class="table-description">
            The Users table stores authentication and profile information for all users of the application.
            This includes personal details, preferences, and account verification status.
        </p>
        <div class="mermaid">
classDiagram
    class users {
        +id: serial PK
        +username: text UNIQUE
        +password: text
        +full_name: text
        +email: text UNIQUE
        +phone: text
        +gender: text
        +place: text
        +achievements: json[]
        +preferred_language: text = "en"
        +health_goals: json[]
        +verification_token: text
        +verified: boolean = false
    }
        </div>
        <button id="users-btn" class="download-btn">Download Users Table as PNG</button>
    </div>
    
    <div class="table-container">
        <h2>Health Data Table</h2>
        <p class="table-description">
            The Health Data table stores all health-related information for users, including demographics,
            physiological measurements, lifestyle factors, and risk predictions. It uses JSON columns
            to store complex nested data structures.
        </p>
        <div class="mermaid">
classDiagram
    class health_data {
        +id: serial PK
        +user_id: integer FK
        +demographics: json
        +physiological: json
        +lifestyle: json
        +prediction: json
        +created_at: text
        +nutrition_plan: json
        +exercise_plan: json
        +achievements: json
        +medical_records: json
    }
        </div>
        <button id="health-btn" class="download-btn">Download Health Data Table as PNG</button>
    </div>
    
    <div class="table-container">
        <h2>Health Data JSON Structure</h2>
        <p class="table-description">
            This diagram shows the detailed structure of the JSON columns in the Health Data table.
            Each of these structures is stored as a JSON object within the respective columns.
        </p>
        <div class="mermaid">
classDiagram
    class demographics {
        +age: number
        +gender: string
        +ethnicity: string
    }
    
    class physiological {
        +height: number
        +weight: number
        +bloodPressure: object
        +bloodSugar: number
        +a1c: number?
        +gtt: number?
        +hemoglobin: number?
    }
    
    class lifestyle {
        +exercise: string
        +diet: string
        +workStyle: string
        +alcohol: string
        +smoking: string
    }
    
    class mentalHealth {
        +stressLevel: string
        +moodPattern: string
        +sleepQuality: string
        +anxietyLevel: string
        +copingMechanisms: string[]
    }
    
    class familyHistory {
        +diabetesInFamily: boolean
        +diabeticRelatives: string[]
        +otherConditions: string[]
    }
    
    class prediction {
        +score: number
        +level: string
        +recommendations: string[]
    }
    
    class nutritionPlan {
        +recommendations: string[]
        +mealPlan: object
        +calories: number
        +macros: object
    }
    
    class exercisePlan {
        +recommendations: string[]
        +weeklyPlan: object
        +goals: object
    }
        </div>
        <button id="json-btn" class="download-btn">Download JSON Structure as PNG</button>
    </div>
    
    <div class="table-container">
        <h2>Feedback Table</h2>
        <p class="table-description">
            The Feedback table stores user feedback and ratings about the application.
            This helps in improving the user experience and tracking user satisfaction.
        </p>
        <div class="mermaid">
classDiagram
    class feedback {
        +id: serial PK
        +user_id: integer FK
        +rating: integer
        +category: text
        +comment: text
        +created_at: timestamp
    }
        </div>
        <button id="feedback-btn" class="download-btn">Download Feedback Table as PNG</button>
    </div>
    
    <script>
        mermaid.initialize({ startOnLoad: true });
        
        function downloadMermaidAsPng(container, filename) {
            setTimeout(() => {
                const svgElement = container.querySelector('svg');
                if (!svgElement) {
                    alert('Diagram not rendered yet. Please try again.');
                    return;
                }
                
                // Create canvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Scale up for better quality
                const scale = 2;
                const bbox = svgElement.getBBox();
                canvas.width = bbox.width * scale;
                canvas.height = bbox.height * scale;
                ctx.scale(scale, scale);
                
                // Create image from SVG
                const svgData = new XMLSerializer().serializeToString(svgElement);
                const img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, 0, 0);
                    
                    // Download image
                    const a = document.createElement('a');
                    a.href = canvas.toDataURL('image/png');
                    a.download = filename;
                    a.click();
                };
                
                img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
            }, 1000); // Small delay to ensure diagram is rendered
        }
        
        document.getElementById('schema-btn').addEventListener('click', function() {
            const container = this.parentElement.querySelector('.mermaid');
            downloadMermaidAsPng(container, 'glucosmart_complete_schema.png');
        });
        
        document.getElementById('users-btn').addEventListener('click', function() {
            const container = this.parentElement.querySelector('.mermaid');
            downloadMermaidAsPng(container, 'glucosmart_users_table.png');
        });
        
        document.getElementById('health-btn').addEventListener('click', function() {
            const container = this.parentElement.querySelector('.mermaid');
            downloadMermaidAsPng(container, 'glucosmart_health_data_table.png');
        });
        
        document.getElementById('json-btn').addEventListener('click', function() {
            const container = this.parentElement.querySelector('.mermaid');
            downloadMermaidAsPng(container, 'glucosmart_json_structure.png');
        });
        
        document.getElementById('feedback-btn').addEventListener('click', function() {
            const container = this.parentElement.querySelector('.mermaid');
            downloadMermaidAsPng(container, 'glucosmart_feedback_table.png');
        });
    </script>
</body>
</html>
